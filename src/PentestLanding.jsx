import { useState, useEffect, useRef } from "react";
import { Link } from "react-router-dom";
import { Shield, Network, Server, CheckCircle, Clock, FileText } from "lucide-react";

export default function PentestLanding() {
  const [submitted, setSubmitted] = useState(false);
  const [cookiesAccepted, setCookiesAccepted] = useState(false);
  const formRef = useRef(null);

  // Fonction pour accepter les cookies
  const handleAcceptCookies = () => {
    setCookiesAccepted(true);
    localStorage.setItem("cookiesAccepted", "true");
  };

  // V√©rifie si l'utilisateur a d√©j√† accept√© les cookies
  useEffect(() => {
    const accepted = localStorage.getItem("cookiesAccepted");
    if (accepted === "true") setCookiesAccepted(true);
  }, []);

  // Fonction pour revenir au formulaire
  const scrollToForm = () => {
    setSubmitted(false);
    setTimeout(() => {
      formRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
  };

  /* -------------------------------------------------
     üîí Int√©gration future de Stripe (comment√©e pour l‚Äôinstant)
  ---------------------------------------------------
  import { loadStripe } from "@stripe/stripe-js";

  const stripePromise = loadStripe("pk_test_XXXXXXXXXXXXXXXXXXXXXXXX");

  const handleStripePayment = async (offer) => {
    const stripe = await stripePromise;
    const response = await fetch("/create-checkout-session", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ plan: offer.title, amount: offer.price }),
    });
    const session = await response.json();
    await stripe.redirectToCheckout({ sessionId: session.id });
  };
  ------------------------------------------------- */

  return (
    <div className="min-h-screen bg-black text-white font-sans">
      {/* Header */}
      <header className="text-center py-16 border-b border-white/10 relative overflow-hidden">
        <div
          className="absolute inset-0 opacity-5"
          style={{
            backgroundImage: `linear-gradient(#00FF99 1px, transparent 1px),
                              linear-gradient(90deg, #00FF99 1px, transparent 1px)`,
            backgroundSize: "40px 40px",
          }}
        />
        <div className="relative z-10">
          <div className="w-20 h-20 mx-auto mb-6 rounded-xl flex items-center justify-center border border-green-500/30 bg-black shadow-[0_0_30px_#00ff80]">
            <div className="text-3xl font-bold text-green-400 drop-shadow-[0_0_8px_#00ff80] font-mono">
              HL
            </div>
          </div>
          <h1 className="text-4xl md:text-5xl font-extrabold mb-4 bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">
            HackLayer ‚Äî Testez votre s√©curit√© avant qu'un hacker ne le fasse.
          </h1>
          <p className="text-white/60 text-lg">
            Pentesting professionnel ‚Ä¢ Audit de s√©curit√© ‚Ä¢ Protection contre les cybermenaces
          </p>
        </div>
      </header>

      {/* Pourquoi r√©aliser un Pentest ? */}
      <section className="max-w-4xl mx-auto py-16 px-6">
        <h2 className="text-3xl font-bold mb-6 text-center">Pourquoi r√©aliser un Pentest ?</h2>
        <p className="text-white/80 leading-relaxed text-center mb-8">
          Les cyberattaques se multiplient et deviennent de plus en plus sophistiqu√©es. Un test d'intrusion permet d'identifier et corriger les failles avant qu'elles ne soient exploit√©es. Le Pentest simule une attaque r√©elle sur vos syst√®mes pour √©valuer leur robustesse et renforcer votre d√©fense.
        </p>
        <div className="bg-gradient-to-r from-green-500/10 to-blue-500/10 border border-green-500/20 rounded-xl p-6 text-center">
          <p className="text-xl font-semibold text-green-400">
            üí° En r√©sum√© : mieux vaut se faire pirater par HackLayer que par un vrai hacker.
          </p>
        </div>
      </section>

      {/* Points forts */}
      <section className="max-w-5xl mx-auto px-6 py-12">
        <div className="grid md:grid-cols-3 gap-6">
          <div className="bg-white/5 p-6 rounded-xl border border-white/10 text-center hover:bg-white/8 transition">
            <CheckCircle className="w-12 h-12 text-green-400 mx-auto mb-4" />
            <h3 className="font-bold text-lg mb-2">10+ ans d'exp√©rience</h3>
            <p className="text-white/70 text-sm">Expert certifi√© en cybers√©curit√©</p>
          </div>
          <div className="bg-white/5 p-6 rounded-xl border border-white/10 text-center hover:bg-white/8 transition">
            <Clock className="w-12 h-12 text-green-400 mx-auto mb-4" />
            <h3 className="font-bold text-lg mb-2">Livraison rapide</h3>
            <p className="text-white/70 text-sm">Rapport d√©taill√© sous 4 jours</p>
          </div>
          <div className="bg-white/5 p-6 rounded-xl border border-white/10 text-center hover:bg-white/8 transition">
            <FileText className="w-12 h-12 text-green-400 mx-auto mb-4" />
            <h3 className="font-bold text-lg mb-2">Documentation compl√®te</h3>
            <p className="text-white/70 text-sm">Recommandations d√©taill√©es</p>
          </div>
        </div>
      </section>

      {/* Abonnements */}
      <section className="max-w-6xl mx-auto grid md:grid-cols-3 gap-8 px-6 py-12">
        {[{
          title: "Scan de vuln√©rabilit√©s (Web) ‚Äî automatis√©",
          price: "399 ‚Ç¨ TTC",
          desc: "Scan automatique de vos applications web (DAST/SAST) avec rapport synth√©tique. Id√©al pour un premier diagnostic.",
          icon: <Shield className="w-10 h-10 text-green-400" />,
          popular: false,
          features: [
            "Scan complet OWASP Top 10",
            "Rapport synth√©tique (PDF)",
            "Priorisation des vuln√©rabilit√©s",
            "Sans test manuel ni exploitation"
          ]
        }, {
          title: "Pentest Web ‚Äî manuel (standard)",
          price: "2 900 ‚Ç¨ TTC",
          desc: "Test d‚Äôintrusion manuel de vos applications web (2‚Äì3 jours). Inclut exploitation contr√¥l√©e et rapport complet.",
          icon: <Network className="w-10 h-10 text-green-400" />,
          popular: true,
          features: [
            "Analyse manuelle approfondie",
            "Exploitation des vuln√©rabilit√©s critiques",
            "Rapport technique + synth√®se ex√©cutive",
            "Recommandations d√©taill√©es"
          ]
        }, {
          title: "Pentest Interne ‚Äî avanc√© (50‚Äì250 IP)",
          price: "7 500 ‚Ç¨ TTC",
          desc: "Audit complet de votre r√©seau interne avec sc√©narios d‚Äôattaque r√©alistes, pivoting et rapport d√©taill√©.",
          icon: <Server className="w-10 h-10 text-green-400" />,
          popular: false,
          features: [
            "D√©couverte r√©seau et tests d‚Äôacc√®s",
            "Exploitation contr√¥l√©e et pivoting",
            "Rapport d√©taill√© + plan de rem√©diation",
            "NDA et autorisation requises"
          ]
        }].map((offer, i) => (
          <div
            key={i}
            className={`bg-white/5 p-6 rounded-2xl border text-center hover:bg-white/10 transition relative ${
              offer.popular
                ? 'border-green-400 shadow-[0_0_20px_rgba(0,255,153,0.3)]'
                : 'border-white/10'
            }`}
          >
            {offer.popular && (
              <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-green-400 text-black text-xs font-bold px-3 py-1 rounded-full">
                POPULAIRE
              </div>
            )}
            <div className="flex justify-center mb-4">{offer.icon}</div>
            <h3 className="text-2xl font-bold mb-2">{offer.title}</h3>
            <p className="text-green-400 font-semibold text-xl mb-4">{offer.price}</p>
            <p className="text-sm text-white/70 mb-4">{offer.desc}</p>

            <ul className="text-left text-sm text-white/70 mb-6">
              {offer.features.map((feat, idx) => (
                <li key={idx}>‚Ä¢ {feat}</li>
              ))}
            </ul>

            {/* Int√©gration Stripe ‚Äî √† activer plus tard */}
            {/*
            <button
              onClick={() => handleStripePayment(offer)}
              className="bg-green-500 hover:bg-green-600 text-black font-semibold px-6 py-2 rounded-full transition w-full"
            >
              Commander avec Stripe
            </button>
            */}

            {/* Bouton temporaire sans int√©gration */}
            <button
              onClick={() =>
                alert(`L‚Äôint√©gration Stripe pour "${offer.title}" sera bient√¥t disponible.`)
              }
              className="bg-green-500 hover:bg-green-600 text-black font-semibold px-6 py-2 rounded-full transition w-full"
            >
              Commander (√† venir)
            </button>
          </div>
        ))}
      </section>

      {/* Section T√©moignages */}
<section className="max-w-5xl mx-auto px-6 py-16">
  <h2 className="text-3xl font-bold mb-2 text-center">Ce qu'en disent nos clients</h2>
  <p className="text-white/60 text-center mb-12">Audits professionnels r√©alis√©s pour PME et startups</p>
  
  <div className="grid md:grid-cols-3 gap-6">
    {/* T√©moignage 1 */}
    <div className="bg-white/5 p-6 rounded-xl border border-white/10 hover:border-green-400/30 transition">
      <div className="flex items-center gap-2 mb-4 text-green-400">
        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
      </div>
      <p className="text-white/80 italic mb-4">
        "Audit complet et professionnel. HackLayer a d√©tect√© 8 vuln√©rabilit√©s critiques que nous ignorions. Service rapide et recommandations claires."
      </p>
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-full bg-green-400/20 flex items-center justify-center text-green-400 font-bold">
          JD
        </div>
        <div>
          <p className="font-semibold text-sm">Alexandre Martin</p>
          <p className="text-white/50 text-xs">CTO, TechStartup</p>
        </div>
      </div>
    </div>

    {/* T√©moignage 2 */}
    <div className="bg-white/5 p-6 rounded-xl border border-white/10 hover:border-green-400/30 transition">
      <div className="flex items-center gap-2 mb-4 text-green-400">
        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
      </div>
      <p className="text-white/80 italic mb-4">
        "Pentest r√©alis√© en 3 jours avec un rapport d√©taill√©. Nous avons pu corriger les failles avant notre mise en production. Excellent investissement !"
      </p>
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-full bg-green-400/20 flex items-center justify-center text-green-400 font-bold">
          ML
        </div>
        <div>
          <p className="font-semibold text-sm">Marie Lambert</p>
          <p className="text-white/50 text-xs">CEO, E-commerce</p>
        </div>
      </div>
    </div>

    {/* T√©moignage 3 */}
    <div className="bg-white/5 p-6 rounded-xl border border-white/10 hover:border-green-400/30 transition">
      <div className="flex items-center gap-2 mb-4 text-green-400">
        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
      </div>
      <p className="text-white/80 italic mb-4">
         "Audit de smart contract impeccable. HackLayer a trouv√© une faille critique qui aurait pu nous co√ªter plusieurs milliers d'euros. Tr√®s recommand√©."
      </p>
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-full bg-green-400/20 flex items-center justify-center text-green-400 font-bold">
          TC
        </div>
        <div>
          <p className="font-semibold text-sm">Thomas Chen</p>
          <p className="text-white/50 text-xs">Founder, CryptoProject</p>
        </div>
      </div>
    </div>
  </div>
</section>

      {/* Formulaire Netlify */}
<section ref={formRef} className="max-w-3xl mx-auto px-6 py-16 text-center scroll-mt-20">
  <h2 className="text-3xl font-bold mb-6">Contactez-nous</h2>

  {!submitted ? (
    <form
      name="pentest-contact"
      method="POST"
      data-netlify="true"
      data-netlify-honeypot="bot-field"
      className="space-y-4 bg-white/5 p-8 rounded-2xl border border-white/10"
      onSubmit={(e) => {
        e.preventDefault();
        const form = e.target;

        const encode = (data) =>
          Object.keys(data)
            .map(
              (key) => encodeURIComponent(key) + "=" + encodeURIComponent(data[key])
            )
            .join("&");

        const data = {
          "form-name": form.getAttribute("name"),
          prenom: form.prenom.value,
          nom: form.nom.value,
          entreprise: form.entreprise.value,
          email: form.email.value,
          message: form.message.value,
        };

        // ‚úÖ Correction : on cible bien "/" (sans ?no-cache)
        fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: encode(data),
        })
          .then((response) => {
            if (response.ok) {
              form.reset();
              setSubmitted(true);
            } else {
              throw new Error("Erreur de soumission");
            }
          })
          .catch(() => alert("‚ùå Erreur d'envoi ‚Äî veuillez r√©essayer."));
      }}
    >
      {/* Champs cach√©s Netlify */}
      <input type="hidden" name="form-name" value="pentest-contact" />
      <p className="hidden">
        <label>
          Don‚Äôt fill this out if you‚Äôre human: <input name="bot-field" />
        </label>
      </p>

      {/* Champs visibles */}
      <div className="grid md:grid-cols-2 gap-4">
        <input
          name="prenom"
          required
          placeholder="Pr√©nom"
          className="w-full p-3 bg-black border border-white/10 rounded-lg text-white focus:border-green-400 focus:outline-none transition"
        />
        <input
          name="nom"
          required
          placeholder="Nom"
          className="w-full p-3 bg-black border border-white/10 rounded-lg text-white focus:border-green-400 focus:outline-none transition"
        />
      </div>

      <input
        name="entreprise"
        placeholder="Entreprise / Organisation"
        className="w-full p-3 bg-black border border-white/10 rounded-lg text-white focus:border-green-400 focus:outline-none transition"
      />

      <input
        name="email"
        required
        type="email"
        placeholder="Email"
        className="w-full p-3 bg-black border border-white/10 rounded-lg text-white focus:border-green-400 focus:outline-none transition"
      />

      <textarea
        name="message"
        required
        placeholder="Votre message..."
        rows="5"
        className="w-full p-3 bg-black border border-white/10 rounded-lg text-white focus:border-green-400 focus:outline-none transition"
      />

      <button
        type="submit"
        className="bg-green-500 hover:bg-green-600 text-black font-semibold px-8 py-2 rounded-full transition w-full"
      >
        Envoyer
      </button>
    </form>
  ) : (
    <div className="bg-white/5 p-8 rounded-2xl border border-green-400/50">
      <CheckCircle className="w-16 h-16 text-green-400 mx-auto mb-4" />
      <p className="text-green-400 text-xl font-semibold mb-4">
        Merci ‚Äî nous accusons r√©ception de votre message.
      </p>
      <p className="text-white/70 mb-6">
        Vous recevrez une r√©ponse sous 24 heures. ‚úÖ
      </p>
      <button
        onClick={() => setSubmitted(false)}
        className="bg-white/10 hover:bg-white/20 text-green-400 font-semibold px-6 py-2 rounded-full border border-green-400/30 transition"
      >
        Envoyer un autre message
      </button>
    </div>
  )}
</section>

      {/* Footer */}
      <footer className="bg-black text-white py-10 text-center border-t border-white/10">
        <div className="flex flex-wrap justify-center items-center gap-6 mb-6">
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png"
            alt="Visa"
            className="h-8 w-auto object-contain transition-transform duration-300 hover:scale-110 hover:drop-shadow-[0_0_10px_#00FF99]"
          />
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg"
            alt="Mastercard"
            className="h-8 w-auto object-contain transition-transform duration-300 hover:scale-110 hover:drop-shadow-[0_0_10px_#00FF99]"
          />
          <div className="bg-[#635BFF] px-4 py-2 rounded-md transition-transform duration-300 hover:scale-110 hover:drop-shadow-[0_0_15px_#635BFF]">
            <span className="text-white font-bold text-lg tracking-tight">stripe</span>
          </div>
          <div className="bg-white rounded-md px-2 py-1 flex items-center justify-center transition-transform duration-300 hover:scale-110 hover:drop-shadow-[0_0_15px_#00FF99]">
            <img src="/logos/ssl.svg" alt="SSL S√©curis√©" className="h-5 w-auto object-contain" />
          </div>
        </div>

        <p className="text-sm text-white/60 mb-4">
          Paiement s√©curis√© via{" "}
          <span className="text-[#00FF99] font-semibold neon-text">Stripe</span> ‚Äî{" "}
          <Link
            to="/mentions-legales"
            className="underline hover:text-[#00FF99] transition-colors duration-300"
          >
            Mentions l√©gales & Cookies
          </Link>
          <span className="mx-3">‚Ä¢</span>
          <Link to="/conditions-vente" className="text-green-400 underline hover:text-green-300">
            Conditions G√©n√©rales de Vente
          </Link>
        </p>

        <Link
          to="/"
          className="inline-block text-[#00FF99] font-medium hover:underline hover:text-[#00ffaa] transition-all duration-300"
        >
          ‚Üê Retour au portfolio
        </Link>
      </footer>

      {/* Cookie Banner */}
      {!cookiesAccepted && (
        <div className="fixed bottom-4 left-4 right-4 md:right-auto md:max-w-md bg-white/10 p-4 rounded-xl border border-white/10 text-sm backdrop-blur-md shadow-lg">
          Ce site utilise des cookies pour am√©liorer votre exp√©rience.{" "}
          <button
            onClick={handleAcceptCookies}
            className="ml-2 text-green-400 underline hover:text-green-300 transition"
          >
            Accepter
          </button>
        </div>
      )}
    </div>
  );
}
